<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HKDSE Physics Diagnostic</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/recharts/umd/Recharts.js"></script>
    <style>
        body { background-color: #f8fafc; }
        .fade-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        .card-hover { transition: all 0.2s ease; }
        .card-hover:hover { transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
    </style>
</head>
<body>
    <div id="root" class="min-h-screen text-slate-600 font-sans">
        Loading...
    </div>

    <script type="text/babel">
        const { useState, useMemo, useEffect } = React;
        const { ResponsiveContainer, RadarChart, PolarGrid, PolarAngleAxis, PolarRadiusAxis, Radar, Tooltip, Legend } = Recharts;

        // --- ICONS ---
        const Icons = {
            Check: () => <svg className="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M5 13l4 4L19 7"></path></svg>,
            X: () => <svg className="w-5 h-5 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12"></path></svg>,
            ArrowRight: () => <svg className="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 5l7 7-7 7"></path></svg>,
            Home: () => <svg className="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg>,
            Book: () => <svg className="w-5 h-5 text-indigo-500 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path></svg>,
            Atom: () => <svg className="w-5 h-5 text-purple-500 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.384-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"></path></svg>,
            Chart: () => <svg className="w-5 h-5 text-teal-500 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z"></path><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M20.488 9H15V3.512A9.025 9.025 0 0120.488 9z"></path></svg>,
            Trash: () => <svg className="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
        };

        // --- 50 HKDSE QUESTIONS ---
        const QUESTIONS = [
            // --- KINEMATICS (Linear Motion) ---
            {
                id: 1,
                concept: "Linear Motion",
                text: "A runner completes one lap around a circular track of radius R. What are the displacement and distance traveled?",
                options: [
                    { id: 'A', text: "Displacement: 2πR, Distance: 2πR" },
                    { id: 'B', text: "Displacement: 0, Distance: 2πR" },
                    { id: 'C', text: "Displacement: 0, Distance: 0" },
                    { id: 'D', text: "Displacement: 2R, Distance: 2πR" }
                ],
                correctAnswer: 'B',
                explanation: "Displacement is a vector quantity referring to the change in position. Since the runner ends where they started, displacement is 0. Distance is the scalar total path length (circumference)."
            },
            {
                id: 2,
                concept: "Linear Motion",
                text: "An object is thrown vertically upwards. At the highest point of its trajectory:",
                options: [
                    { id: 'A', text: "Velocity is zero, acceleration is zero." },
                    { id: 'B', text: "Velocity is maximum, acceleration is zero." },
                    { id: 'C', text: "Velocity is zero, acceleration is approximately 9.81 m/s² downwards." },
                    { id: 'D', text: "Velocity is zero, acceleration is 9.81 m/s² upwards." }
                ],
                correctAnswer: 'C',
                explanation: "At the peak, the object momentarily stops (v=0), but gravity is still acting on it. Acceleration due to gravity (g) is constant throughout the flight."
            },
            {
                id: 3,
                concept: "Linear Motion",
                text: "Which of the following v-t graphs represents an object thrown upwards and returning to the thrower's hand (taking up as positive)?",
                options: [
                    { id: 'A', text: "A V-shape starting positive, hitting zero, going positive again." },
                    { id: 'B', text: "A straight line with negative slope, starting positive, crossing zero to negative." },
                    { id: 'C', text: "A parabolic curve." },
                    { id: 'D', text: "A horizontal line." }
                ],
                correctAnswer: 'B',
                explanation: "Gravity provides a constant negative acceleration. On a v-t graph, constant acceleration is a straight line. The slope is negative (-g)."
            },
            {
                id: 4,
                concept: "Linear Motion",
                text: "If the s-t (displacement-time) graph is a curve with increasing slope (concave up), the object is:",
                options: [
                    { id: 'A', text: "Moving with constant velocity." },
                    { id: 'B', text: "Decelerating." },
                    { id: 'C', text: "Accelerating." },
                    { id: 'D', text: "Stationary." }
                ],
                correctAnswer: 'C',
                explanation: "The slope of an s-t graph is velocity. If the slope is increasing (getting steeper), the velocity is increasing, which means acceleration."
            },
            {
                id: 5,
                concept: "Linear Motion",
                text: "A car travels from A to B at 40 km/h and returns from B to A at 60 km/h. What is the average speed?",
                options: [
                    { id: 'A', text: "50 km/h" },
                    { id: 'B', text: "48 km/h" },
                    { id: 'C', text: "0 km/h" },
                    { id: 'D', text: "55 km/h" }
                ],
                correctAnswer: 'B',
                explanation: "Average speed = Total Distance / Total Time. Let distance be d. Time1 = d/40, Time2 = d/60. Total time = d(1/40 + 1/60). Avg Speed = 2d / [d(5/120)] = 48 km/h."
            },
            {
                id: 6,
                concept: "Linear Motion",
                text: "Two objects of different mass are dropped from the same height in a vacuum. Which hits the ground first?",
                options: [
                    { id: 'A', text: "The heavier object." },
                    { id: 'B', text: "The lighter object." },
                    { id: 'C', text: "They hit at the same time." },
                    { id: 'D', text: "Depends on their density." }
                ],
                correctAnswer: 'C',
                explanation: "In a vacuum (no air resistance), acceleration due to gravity (g) is independent of mass. s = ut + 1/2at². Both have same s, u, and a, so t is the same."
            },
            {
                id: 7,
                concept: "Linear Motion",
                text: "The area under a velocity-time graph represents:",
                options: [
                    { id: 'A', text: "Acceleration." },
                    { id: 'B', text: "Instantaneous speed." },
                    { id: 'C', text: "Displacement." },
                    { id: 'D', text: "Force." }
                ],
                correctAnswer: 'C',
                explanation: "Integration of velocity with respect to time gives displacement (change in position)."
            },
            {
                id: 8,
                concept: "Linear Motion",
                text: "An object moving with constant speed in a circle:",
                options: [
                    { id: 'A', text: "Has zero acceleration." },
                    { id: 'B', text: "Has constant velocity." },
                    { id: 'C', text: "Has an acceleration directed towards the center." },
                    { id: 'D', text: "Has an acceleration directed outwards." }
                ],
                correctAnswer: 'C',
                explanation: "Velocity is a vector. Even if speed is constant, direction changes, meaning velocity changes. This requires a centripetal acceleration towards the center."
            },

            // --- FORCE & NEWTON'S LAWS ---
            {
                id: 9,
                concept: "Force",
                text: "A large truck collides head-on with a small car. Which exerts a larger force on the other?",
                options: [
                    { id: 'A', text: "The truck exerts a larger force." },
                    { id: 'B', text: "The car exerts a larger force." },
                    { id: 'C', text: "They exert the same magnitude of force." },
                    { id: 'D', text: "Depends on their speeds." }
                ],
                correctAnswer: 'C',
                explanation: "Newton's 3rd Law: Action and reaction are equal in magnitude and opposite in direction. The forces are identical, though the car suffers more damage due to lower mass (higher acceleration)."
            },
            {
                id: 10,
                concept: "Force",
                text: "An elevator is moving UPWARDS at a CONSTANT velocity. The tension in the cable (T) compared to the weight of the elevator (W) is:",
                options: [
                    { id: 'A', text: "T > W" },
                    { id: 'B', text: "T = W" },
                    { id: 'C', text: "T < W" },
                    { id: 'D', text: "T = 0" }
                ],
                correctAnswer: 'B',
                explanation: "Constant velocity means zero acceleration. By Newton's 1st/2nd Law (F=ma), if a=0, the net force is 0. Therefore, Upward Force (T) must equal Downward Force (W)."
            },
            {
                id: 11,
                concept: "Force",
                text: "A book rests on a table. The Newton's 3rd Law 'reaction pair' to the gravitational force of the Earth pulling on the book is:",
                options: [
                    { id: 'A', text: "The normal force of the table pushing up on the book." },
                    { id: 'B', text: "The book pushing down on the table." },
                    { id: 'C', text: "The gravitational force of the book pulling on the Earth." },
                    { id: 'D', text: "Friction acting on the book." }
                ],
                correctAnswer: 'C',
                explanation: "N3L pairs must involve the same two objects (Earth and Book) and the same type of force (Gravity). Earth pulls Book; Book pulls Earth."
            },
            {
                id: 12,
                concept: "Force",
                text: "If the resultant force acting on a moving object suddenly becomes zero, the object will:",
                options: [
                    { id: 'A', text: "Stop immediately." },
                    { id: 'B', text: "Slow down and stop." },
                    { id: 'C', text: "Continue moving at constant velocity." },
                    { id: 'D', text: "Change direction." }
                ],
                correctAnswer: 'C',
                explanation: "Newton's 1st Law (Inertia). An object in motion stays in motion with constant velocity unless acted upon by a net external force."
            },
            {
                id: 13,
                concept: "Force",
                text: "A block is pushed across a rough horizontal surface at constant velocity. The friction force is:",
                options: [
                    { id: 'A', text: "Greater than the pushing force." },
                    { id: 'B', text: "Less than the pushing force." },
                    { id: 'C', text: "Equal to the pushing force." },
                    { id: 'D', text: "Zero." }
                ],
                correctAnswer: 'C',
                explanation: "Constant velocity implies equilibrium (a=0). The forward pushing force must exactly balance the backward kinetic friction force."
            },
            {
                id: 14,
                concept: "Force",
                text: "Which of the following is NOT a vector quantity?",
                options: [
                    { id: 'A', text: "Displacement" },
                    { id: 'B', text: "Force" },
                    { id: 'C', text: "Momentum" },
                    { id: 'D', text: "Mass" }
                ],
                correctAnswer: 'D',
                explanation: "Mass is a scalar quantity (magnitude only). The others have both magnitude and direction."
            },
            {
                id: 15,
                concept: "Force",
                text: "A skydiver falls and reaches terminal velocity. At this point:",
                options: [
                    { id: 'A', text: "Air resistance is zero." },
                    { id: 'B', text: "Gravity is zero." },
                    { id: 'C', text: "Air resistance equals weight." },
                    { id: 'D', text: "Air resistance is greater than weight." }
                ],
                correctAnswer: 'C',
                explanation: "Terminal velocity is a constant velocity. This happens when the upward drag (air resistance) increases enough to exactly balance the downward weight."
            },
            {
                id: 16,
                concept: "Force",
                text: "An object is on a smooth slope inclined at θ. The component of weight acting down the slope is:",
                options: [
                    { id: 'A', text: "mg sin θ" },
                    { id: 'B', text: "mg cos θ" },
                    { id: 'C', text: "mg tan θ" },
                    { id: 'D', text: "mg" }
                ],
                correctAnswer: 'A',
                explanation: "Weight (mg) acts vertically down. Resolving it parallel to the slope gives mg sin θ. The perpendicular component is mg cos θ."
            },
            {
                id: 17,
                concept: "Force",
                text: "Inertia is best defined as:",
                options: [
                    { id: 'A', text: "The force that keeps objects moving." },
                    { id: 'B', text: "The tendency of an object to resist changes in its state of motion." },
                    { id: 'C', text: "The speed of an object." },
                    { id: 'D', text: "The weight of an object." }
                ],
                correctAnswer: 'B',
                explanation: "Inertia is the property of matter that resists acceleration. It is directly related to mass."
            },

            // --- MOMENT OF FORCE ---
            {
                id: 18,
                concept: "Moment of Force",
                text: "The moment of a force is defined as:",
                options: [
                    { id: 'A', text: "Force × Distance traveled" },
                    { id: 'B', text: "Force × Perpendicular distance from pivot" },
                    { id: 'C', text: "Mass × Acceleration" },
                    { id: 'D', text: "Force / Area" }
                ],
                correctAnswer: 'B',
                explanation: "Moment (Torque) = F × d, where d is the perpendicular distance from the line of action of the force to the pivot."
            },
            {
                id: 19,
                concept: "Moment of Force",
                text: "To open a heavy door most easily, you should push:",
                options: [
                    { id: 'A', text: "Close to the hinges." },
                    { id: 'B', text: "In the middle of the door." },
                    { id: 'C', text: "Far from the hinges (at the handle)." },
                    { id: 'D', text: "It doesn't matter." }
                ],
                correctAnswer: 'C',
                explanation: "Moment = F × d. To maximize the turning effect (Moment) with the same Force, you need to maximize the distance (d) from the pivot (hinges)."
            },
            {
                id: 20,
                concept: "Moment of Force",
                text: "For a rigid body to be in equilibrium, which condition(s) must be met?",
                options: [
                    { id: 'A', text: "Resultant force is zero only." },
                    { id: 'B', text: "Resultant moment is zero only." },
                    { id: 'C', text: "Both resultant force and resultant moment are zero." },
                    { id: 'D', text: "It must be stationary." }
                ],
                correctAnswer: 'C',
                explanation: "Equilibrium requires no translational acceleration (Net Force = 0) AND no rotational acceleration (Net Moment = 0)."
            },
            {
                id: 21,
                concept: "Moment of Force",
                text: "Two equal and opposite parallel forces that do not act along the same line form a:",
                options: [
                    { id: 'A', text: "Equilibrium." },
                    { id: 'B', text: "Couple." },
                    { id: 'C', text: "Newton pair." },
                    { id: 'D', text: "Zero moment." }
                ],
                correctAnswer: 'B',
                explanation: "A couple produces pure rotation (a moment) but no translation (net force is zero)."
            },
            {
                id: 22,
                concept: "Moment of Force",
                text: "A uniform meter rule is balanced at the 50cm mark. If a mass is placed at the 10cm mark, where must an equal mass be placed to restore balance?",
                options: [
                    { id: 'A', text: "90 cm mark" },
                    { id: 'B', text: "60 cm mark" },
                    { id: 'C', text: "100 cm mark" },
                    { id: 'D', text: "40 cm mark" }
                ],
                correctAnswer: 'A',
                explanation: "The pivot is at 50. The mass at 10 is 40cm from pivot (left). To balance, the other mass must be 40cm from pivot (right). 50 + 40 = 90cm."
            },
            {
                id: 23,
                concept: "Moment of Force",
                text: "The SI unit for the Moment of a Force is:",
                options: [
                    { id: 'A', text: "Joule (J)" },
                    { id: 'B', text: "Newton (N)" },
                    { id: 'C', text: "Newton meter (Nm)" },
                    { id: 'D', text: "Watt (W)" }
                ],
                correctAnswer: 'C',
                explanation: "Force (N) × Distance (m) = Nm. While dimensionally similar to Joules, we use Nm for torque to distinguish it from Energy."
            },
            {
                id: 24,
                concept: "Moment of Force",
                text: "An object is most stable when:",
                options: [
                    { id: 'A', text: "Its center of gravity is high and base is narrow." },
                    { id: 'B', text: "Its center of gravity is low and base is wide." },
                    { id: 'C', text: "Its center of gravity is high and base is wide." },
                    { id: 'D', text: "Its center of gravity is low and base is narrow." }
                ],
                correctAnswer: 'B',
                explanation: "Stability is improved by lowering the Center of Gravity (lowering potential energy) and widening the base (requiring a larger tilt to topple)."
            },
            {
                id: 25,
                concept: "Moment of Force",
                text: "A ladder leans against a smooth wall. The friction acting on the foot of the ladder acts:",
                options: [
                    { id: 'A', text: "Towards the wall." },
                    { id: 'B', text: "Away from the wall." },
                    { id: 'C', text: "Upwards." },
                    { id: 'D', text: "Downwards." }
                ],
                correctAnswer: 'A',
                explanation: "The ladder has a tendency to slip *away* from the wall at the bottom. Friction opposes motion, so it acts *towards* the wall."
            },

            // --- WORK, ENERGY & POWER ---
            {
                id: 26,
                concept: "Work & Energy",
                text: "A waiter carries a tray horizontally across a room at constant speed. The work done by the waiter on the tray is:",
                options: [
                    { id: 'A', text: "Positive." },
                    { id: 'B', text: "Negative." },
                    { id: 'C', text: "Zero." },
                    { id: 'D', text: "Depends on the weight." }
                ],
                correctAnswer: 'C',
                explanation: "Work = F × s × cos(θ). The force (lift) is vertical. The displacement is horizontal. The angle is 90°. cos(90) = 0, so Work = 0."
            },
            {
                id: 27,
                concept: "Work & Energy",
                text: "Kinetic Energy (KE) and Momentum (p) are related by the equation:",
                options: [
                    { id: 'A', text: "KE = p / m" },
                    { id: 'B', text: "KE = p² / 2m" },
                    { id: 'C', text: "KE = mp" },
                    { id: 'D', text: "KE = p²m" }
                ],
                correctAnswer: 'B',
                explanation: "KE = 1/2 mv². Multiply top and bottom by m: KE = (m²v²) / 2m. Since p = mv, KE = p² / 2m."
            },
            {
                id: 28,
                concept: "Work & Energy",
                text: "A ball is dropped. Ignoring air resistance, as it falls:",
                options: [
                    { id: 'A', text: "PE increases, KE decreases." },
                    { id: 'B', text: "PE decreases, KE increases." },
                    { id: 'C', text: "Both PE and KE increase." },
                    { id: 'D', text: "Total mechanical energy decreases." }
                ],
                correctAnswer: 'B',
                explanation: "Conservation of Energy: Gravitational Potential Energy (mgh) is converted into Kinetic Energy (1/2 mv²) as height decreases and speed increases."
            },
            {
                id: 29,
                concept: "Work & Energy",
                text: "Power is defined as:",
                options: [
                    { id: 'A', text: "Rate of doing work." },
                    { id: 'B', text: "Total work done." },
                    { id: 'C', text: "Force × Velocity²." },
                    { id: 'D', text: "Change in momentum." }
                ],
                correctAnswer: 'A',
                explanation: "Power = Work Done / Time. It is the rate of energy transfer."
            },
            {
                id: 30,
                concept: "Work & Energy",
                text: "When a car brakes to a stop, its kinetic energy is primarily converted into:",
                options: [
                    { id: 'A', text: "Potential energy." },
                    { id: 'B', text: "Elastic energy." },
                    { id: 'C', text: "Internal energy (Heat) in the brakes." },
                    { id: 'D', text: "Sound energy only." }
                ],
                correctAnswer: 'C',
                explanation: "Friction does negative work, dissipating mechanical energy into internal energy (heat) via the brake pads and discs."
            },
            {
                id: 31,
                concept: "Work & Energy",
                text: "A crane lifts a load of weight W to height h in time t. The average power output is:",
                options: [
                    { id: 'A', text: "Wh" },
                    { id: 'B', text: "Wh / t" },
                    { id: 'C', text: "Wt / h" },
                    { id: 'D', text: "W / t" }
                ],
                correctAnswer: 'B',
                explanation: "Work Done = Force × Distance = W × h. Power = Work / Time = Wh / t."
            },
            {
                id: 32,
                concept: "Work & Energy",
                text: "The Work-Energy Theorem states that the net work done on an object equals:",
                options: [
                    { id: 'A', text: "Its change in potential energy." },
                    { id: 'B', text: "Its change in kinetic energy." },
                    { id: 'C', text: "Its final momentum." },
                    { id: 'D', text: "Zero." }
                ],
                correctAnswer: 'B',
                explanation: "W_net = ΔKE. If you do net work on an object, you change its speed (and thus KE)."
            },
            {
                id: 33,
                concept: "Work & Energy",
                text: "Two engines have different power ratings. The one with higher power:",
                options: [
                    { id: 'A', text: "Always does more work." },
                    { id: 'B', text: "Always applies more force." },
                    { id: 'C', text: "Does the same work in less time." },
                    { id: 'D', text: "Consumes less fuel." }
                ],
                correctAnswer: 'C',
                explanation: "Higher power means a faster rate of energy transfer. It can do the same amount of work faster than a lower power engine."
            },
            {
                id: 34,
                concept: "Work & Energy",
                text: "1 kWh (kilowatt-hour) is a unit of:",
                options: [
                    { id: 'A', text: "Power." },
                    { id: 'B', text: "Force." },
                    { id: 'C', text: "Energy." },
                    { id: 'D', text: "Time." }
                ],
                correctAnswer: 'C',
                explanation: "Power × Time = Energy. 1 kWh is the energy used by a 1kW device running for 1 hour (3.6 million Joules)."
            },

            // --- MOMENTUM ---
            {
                id: 35,
                concept: "Momentum",
                text: "Momentum is calculated as:",
                options: [
                    { id: 'A', text: "Mass × Acceleration" },
                    { id: 'B', text: "Mass × Velocity" },
                    { id: 'C', text: "Force × Time" },
                    { id: 'D', text: "1/2 Mass × Velocity²" }
                ],
                correctAnswer: 'B',
                explanation: "p = mv. It is a vector quantity."
            },
            {
                id: 36,
                concept: "Momentum",
                text: "The Principle of Conservation of Momentum applies:",
                options: [
                    { id: 'A', text: "Only in elastic collisions." },
                    { id: 'B', text: "Only in inelastic collisions." },
                    { id: 'C', text: "In all collisions where no external forces act." },
                    { id: 'D', text: "Only when kinetic energy is conserved." }
                ],
                correctAnswer: 'C',
                explanation: "Momentum is ALWAYS conserved in a closed system (no net external force), regardless of whether the collision is elastic or inelastic."
            },
            {
                id: 37,
                concept: "Momentum",
                text: "In a perfectly ELASTIC collision:",
                options: [
                    { id: 'A', text: "Only momentum is conserved." },
                    { id: 'B', text: "Only kinetic energy is conserved." },
                    { id: 'C', text: "Both momentum and kinetic energy are conserved." },
                    { id: 'D', text: "Objects stick together." }
                ],
                correctAnswer: 'C',
                explanation: "This is the definition of an elastic collision. Kinetic energy is not lost to heat/sound/deformation."
            },
            {
                id: 38,
                concept: "Momentum",
                text: "Impulse is defined as:",
                options: [
                    { id: 'A', text: "Change in Kinetic Energy." },
                    { id: 'B', text: "Force × Distance." },
                    { id: 'C', text: "Change in Momentum (Force × Time)." },
                    { id: 'D', text: "Rate of change of momentum." }
                ],
                correctAnswer: 'C',
                explanation: "Impulse J = FΔt = Δp (Change in momentum)."
            },
            {
                id: 39,
                concept: "Momentum",
                text: "Airbags in cars reduce injury by:",
                options: [
                    { id: 'A', text: "Reducing the change in momentum." },
                    { id: 'B', text: "Increasing the time of impact, thereby reducing the force." },
                    { id: 'C', text: "Increasing the force of impact." },
                    { id: 'D', text: "Reducing the impulse." }
                ],
                correctAnswer: 'B',
                explanation: "The change in momentum (Impulse) is fixed by the crash speed. By increasing the time (Δt) over which the stop occurs, the average force (F = Δp/Δt) is reduced."
            },
            {
                id: 40,
                concept: "Momentum",
                text: "A cannon fires a cannonball. The cannon recoils backwards because:",
                options: [
                    { id: 'A', text: "Energy is conserved." },
                    { id: 'B', text: "Momentum of the system must remain zero." },
                    { id: 'C', text: "The cannon is lighter than the ball." },
                    { id: 'D', text: "Gravity pulls it back." }
                ],
                correctAnswer: 'B',
                explanation: "Before firing, total momentum is 0. After firing, the forward momentum of the ball must be cancelled by the backward momentum of the cannon to keep the total at 0."
            },
            {
                id: 41,
                concept: "Momentum",
                text: "A 2kg object moving at 3 m/s collides with a stationary 1kg object and they stick together. The final velocity is:",
                options: [
                    { id: 'A', text: "1 m/s" },
                    { id: 'B', text: "2 m/s" },
                    { id: 'C', text: "3 m/s" },
                    { id: 'D', text: "0 m/s" }
                ],
                correctAnswer: 'B',
                explanation: "Conservation of Momentum: (2kg)(3m/s) + (1kg)(0) = (2+1kg)(v). 6 = 3v -> v = 2 m/s."
            },
            {
                id: 42,
                concept: "Momentum",
                text: "The area under a Force-Time graph represents:",
                options: [
                    { id: 'A', text: "Work Done." },
                    { id: 'B', text: "Impulse (Change in momentum)." },
                    { id: 'C', text: "Power." },
                    { id: 'D', text: "Acceleration." }
                ],
                correctAnswer: 'B',
                explanation: "Integral of F dt is Impulse."
            },

            // --- MIXED / ADVANCED CONCEPTS ---
            {
                id: 43,
                concept: "Linear Motion",
                text: "In projectile motion (ignoring air resistance), the horizontal component of velocity:",
                options: [
                    { id: 'A', text: "Increases." },
                    { id: 'B', text: "Decreases." },
                    { id: 'C', text: "Remains constant." },
                    { id: 'D', text: "Is zero." }
                ],
                correctAnswer: 'C',
                explanation: "Gravity acts only vertically. There is no horizontal force, so horizontal acceleration is zero, and horizontal velocity is constant."
            },
            {
                id: 44,
                concept: "Force",
                text: "A block slides down a rough inclined plane at constant speed. The forces acting on it are:",
                options: [
                    { id: 'A', text: "Gravity and Normal force only." },
                    { id: 'B', text: "Gravity, Normal force, and Friction." },
                    { id: 'C', text: "Gravity and Friction only." },
                    { id: 'D', text: "Gravity, Normal force, and a pushing force." }
                ],
                correctAnswer: 'B',
                explanation: "Gravity pulls down, Normal force pushes perpendicular to surface, and Friction acts up the slope to balance the component of gravity (since speed is constant)."
            },
            {
                id: 45,
                concept: "Work & Energy",
                text: "Which requires more work: lifting a 10kg box 2m vertically, or sliding it 2m up a frictionless slope to the same height?",
                options: [
                    { id: 'A', text: "Lifting vertically." },
                    { id: 'B', text: "Sliding up the slope." },
                    { id: 'C', text: "They require the same work." },
                    { id: 'D', text: "Depends on the angle." }
                ],
                correctAnswer: 'C',
                explanation: "Work done against gravity depends only on the change in vertical height (mgh). The path does not matter if friction is absent."
            },
            {
                id: 46,
                concept: "Momentum",
                text: "A rubber ball bounces off a wall. The change in momentum vector is:",
                options: [
                    { id: 'A', text: "Zero." },
                    { id: 'B', text: "Directed into the wall." },
                    { id: 'C', text: "Directed away from the wall." },
                    { id: 'D', text: "Parallel to the wall." }
                ],
                correctAnswer: 'C',
                explanation: "Initial p is towards wall. Final p is away. Δp = p_final - p_initial. (Positive) - (Negative) = Large Positive (Away from wall)."
            },
            {
                id: 47,
                concept: "Moment of Force",
                text: "A uniform rod is hinged at one end. To hold it horizontal, a force F is applied at the other end. F is smallest when applied:",
                options: [
                    { id: 'A', text: "Vertically upwards." },
                    { id: 'B', text: "Horizontally." },
                    { id: 'C', text: "At 45 degrees." },
                    { id: 'D', text: "At 30 degrees." }
                ],
                correctAnswer: 'A',
                explanation: "Moment = F × d × sin(θ). To minimize F, we need to maximize the perpendicular distance/angle effect. 90 degrees (vertical) provides the maximum moment arm."
            },
            {
                id: 48,
                concept: "Linear Motion",
                text: "A ticker-tape timer vibrates at 50 Hz. The time interval between two dots is:",
                options: [
                    { id: 'A', text: "0.02 s" },
                    { id: 'B', text: "0.2 s" },
                    { id: 'C', text: "0.5 s" },
                    { id: 'D', text: "50 s" }
                ],
                correctAnswer: 'A',
                explanation: "T = 1/f = 1/50 = 0.02 seconds."
            },
            {
                id: 49,
                concept: "Force",
                text: "The weight of an astronaut on the Moon is less than on Earth because:",
                options: [
                    { id: 'A', text: "The astronaut has less mass on the Moon." },
                    { id: 'B', text: "There is no atmosphere on the Moon." },
                    { id: 'C', text: "The Moon's gravitational field strength is weaker." },
                    { id: 'D', text: "The astronaut is in free fall." }
                ],
                correctAnswer: 'C',
                explanation: "Mass is constant everywhere. Weight = mg. Since g on the Moon is ~1/6th of Earth's, the weight is less."
            },
            {
                id: 50,
                concept: "Work & Energy",
                text: "Efficiency of a machine is defined as:",
                options: [
                    { id: 'A', text: "Work Output / Work Input × 100%" },
                    { id: 'B', text: "Work Input / Work Output × 100%" },
                    { id: 'C', text: "Power Input / Power Output × 100%" },
                    { id: 'D', text: "Energy Lost / Energy Input × 100%" }
                ],
                correctAnswer: 'A',
                explanation: "Efficiency measures how much of the input energy is usefully transferred. It is always less than 100%."
            }
        ];

        // --- HOOKS FOR STATE MANAGEMENT ---
        function usePersistedState(key, defaultValue) {
            const [state, setState] = useState(() => {
                const storedValue = localStorage.getItem(key);
                return storedValue ? JSON.parse(storedValue) : defaultValue;
            });
            useEffect(() => {
                localStorage.setItem(key, JSON.stringify(state));
            }, [key, state]);
            return [state, setState];
        }

        // --- APP COMPONENTS ---

        function DiagnosticChart({ userAnswers }) {
            const data = useMemo(() => {
                const stats = {};
                
                // Initialize stats for all concepts
                QUESTIONS.forEach(q => {
                    if (!stats[q.concept]) {
                        stats[q.concept] = { total: 0, correct: 0, attempted: 0 };
                    }
                    stats[q.concept].total++;
                });

                // Calculate performance based on user answers
                Object.keys(userAnswers).forEach(qId => {
                    const question = QUESTIONS.find(q => q.id === parseInt(qId));
                    if (question) {
                        stats[question.concept].attempted++;
                        if (userAnswers[qId] === question.correctAnswer) {
                            stats[question.concept].correct++;
                        }
                    }
                });

                return Object.entries(stats).map(([subject, stat]) => {
                    // Score is based only on attempted questions to show current strength
                    // If nothing attempted, score is 0
                    const score = stat.attempted > 0 
                        ? Math.round((stat.correct / stat.attempted) * 100) 
                        : 0;
                    
                    return {
                        subject,
                        score, // For the chart
                        fullMark: 100,
                        attempted: stat.attempted,
                        total: stat.total,
                        correct: stat.correct
                    };
                });
            }, [userAnswers]);

            const totalAttempted = Object.keys(userAnswers).length;

            if (totalAttempted === 0) {
                return (
                    <div className="flex flex-col items-center justify-center h-64 bg-slate-50 rounded-xl border-2 border-dashed border-slate-200">
                        <Icons.Chart />
                        <p className="text-slate-500 mt-2">No data yet. Start a quiz to see your diagnostics!</p>
                    </div>
                );
            }

            return (
                <div className="bg-white p-4 rounded-xl shadow-sm border border-slate-200">
                    <h3 className="text-lg font-bold text-slate-800 mb-4 text-center">Live Topic Proficiency</h3>
                    <div className="h-64 w-full">
                        <ResponsiveContainer width="100%" height="100%">
                            <RadarChart cx="50%" cy="50%" outerRadius="80%" data={data}>
                                <PolarGrid stroke="#e2e8f0" />
                                <PolarAngleAxis dataKey="subject" tick={{ fill: '#64748b', fontSize: 12 }} />
                                <PolarRadiusAxis angle={30} domain={[0, 100]} tick={false} axisLine={false} />
                                <Radar
                                    name="Proficiency"
                                    dataKey="score"
                                    stroke="#4f46e5"
                                    fill="#6366f1"
                                    fillOpacity={0.6}
                                />
                                <Tooltip 
                                    content={({ active, payload }) => {
                                        if (active && payload && payload.length) {
                                            const d = payload[0].payload;
                                            return (
                                                <div className="bg-white p-3 shadow-lg rounded-lg border border-slate-100 text-sm">
                                                    <p className="font-bold text-indigo-900">{d.subject}</p>
                                                    <p className="text-slate-600">Score: <span className="font-semibold">{d.score}%</span></p>
                                                    <p className="text-slate-500 text-xs mt-1">
                                                        ({d.correct} correct out of {d.attempted} attempted)
                                                    </p>
                                                </div>
                                            );
                                        }
                                        return null;
                                    }}
                                />
                            </RadarChart>
                        </ResponsiveContainer>
                    </div>
                    <div className="mt-4 text-center text-sm text-slate-500">
                        Based on {totalAttempted} questions answered so far.
                    </div>
                </div>
            );
        }

        function Menu({ onSelectChapter, onViewDiagnostics, userAnswers, onReset }) {
            // Group questions by concept
            const chapters = useMemo(() => {
                const groups = {};
                QUESTIONS.forEach(q => {
                    if (!groups[q.concept]) groups[q.concept] = 0;
                    groups[q.concept]++;
                });
                return Object.entries(groups).map(([name, count]) => ({ name, count }));
            }, []);

            const totalAnswered = Object.keys(userAnswers).length;

            return (
                <div className="max-w-4xl mx-auto p-6 fade-in">
                    <div className="text-center mb-8 mt-6">
                        <h1 className="text-3xl font-bold text-slate-800 mb-2">HKDSE Physics Diagnostic</h1>
                        <p className="text-slate-500">Select a chapter to begin your practice</p>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                        {/* Live Diagnostics Card */}
                        <div 
                            onClick={onViewDiagnostics}
                            className="bg-teal-600 text-white p-6 rounded-xl cursor-pointer card-hover shadow-lg flex flex-col justify-between h-32 md:col-span-1"
                        >
                            <div className="flex justify-between items-start">
                                <h3 className="font-bold text-xl">My Diagnostics</h3>
                                <Icons.Chart />
                            </div>
                            <div className="flex justify-between items-end opacity-90">
                                <span className="text-sm">View Live Analysis</span>
                                <span className="text-2xl font-bold">{totalAnswered} Done</span>
                            </div>
                        </div>

                        {/* Comprehensive Test Option */}
                        <div 
                            onClick={() => onSelectChapter('ALL')}
                            className="bg-indigo-600 text-white p-6 rounded-xl cursor-pointer card-hover shadow-lg flex flex-col justify-between h-32 md:col-span-2"
                        >
                            <div className="flex justify-between items-start">
                                <h3 className="font-bold text-xl">Comprehensive Test</h3>
                                <Icons.Atom />
                            </div>
                            <div className="flex justify-between items-end opacity-90">
                                <span>All Topics Mixed</span>
                                <span className="text-2xl font-bold">{QUESTIONS.length} Qs</span>
                            </div>
                        </div>
                    </div>

                    <h2 className="text-xl font-bold text-slate-800 mb-4">Topic Chapters</h2>
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        {chapters.map((chapter) => {
                            // Calculate progress for this chapter
                            const chapterQIds = QUESTIONS.filter(q => q.concept === chapter.name).map(q => q.id);
                            const answeredInChapter = chapterQIds.filter(id => userAnswers[id]).length;
                            const isComplete = answeredInChapter === chapter.count;

                            return (
                                <div 
                                    key={chapter.name}
                                    onClick={() => onSelectChapter(chapter.name)}
                                    className={`p-6 rounded-xl cursor-pointer card-hover border shadow-sm flex flex-col justify-between h-32 ${isComplete ? 'bg-indigo-50 border-indigo-200' : 'bg-white border-slate-200'}`}
                                >
                                    <div className="flex justify-between items-start">
                                        <h3 className={`font-bold text-lg ${isComplete ? 'text-indigo-800' : 'text-slate-800'}`}>{chapter.name}</h3>
                                        {isComplete ? <Icons.Check /> : <Icons.Book />}
                                    </div>
                                    <div className="w-full">
                                        <div className="flex justify-between text-xs mb-1 text-slate-500">
                                            <span>Progress</span>
                                            <span>{answeredInChapter}/{chapter.count}</span>
                                        </div>
                                        <div className="w-full bg-slate-100 h-1.5 rounded-full overflow-hidden">
                                            <div 
                                                className="bg-indigo-500 h-full transition-all" 
                                                style={{ width: `${(answeredInChapter / chapter.count) * 100}%` }}
                                            ></div>
                                        </div>
                                    </div>
                                </div>
                            );
                        })}
                    </div>

                    {totalAnswered > 0 && (
                        <div className="mt-12 text-center">
                            <button 
                                onClick={onReset}
                                className="text-red-500 text-sm hover:text-red-700 underline flex items-center justify-center mx-auto"
                            >
                                <Icons.Trash /> Reset All Progress
                            </button>
                        </div>
                    )}
                </div>
            );
        }

        function DiagnosticsView({ userAnswers, onBack }) {
            // Calculate detailed stats table
            const stats = useMemo(() => {
                const data = {};
                QUESTIONS.forEach(q => {
                    if (!data[q.concept]) data[q.concept] = { total: 0, correct: 0, attempted: 0 };
                    data[q.concept].total++;
                    if (userAnswers[q.id]) {
                        data[q.concept].attempted++;
                        if (userAnswers[q.id] === q.correctAnswer) data[q.concept].correct++;
                    }
                });
                return Object.entries(data).map(([name, stat]) => ({ name, ...stat }));
            }, [userAnswers]);

            return (
                <div className="max-w-4xl mx-auto p-6 fade-in">
                    <button onClick={onBack} className="mb-6 text-slate-500 hover:text-slate-800 flex items-center font-medium transition-colors">
                        <svg className="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M15 19l-7-7 7-7"></path></svg>
                        Back to Menu
                    </button>

                    <h1 className="text-2xl font-bold text-slate-800 mb-6">Performance Diagnostics</h1>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                        {/* Chart Section */}
                        <div>
                            <DiagnosticChart userAnswers={userAnswers} />
                        </div>

                        {/* Stats Summary */}
                        <div className="space-y-4">
                            {stats.map(stat => {
                                const percentage = stat.attempted > 0 ? Math.round((stat.correct / stat.attempted) * 100) : 0;
                                let colorClass = "bg-slate-100 text-slate-600";
                                if (stat.attempted > 0) {
                                    if (percentage >= 75) colorClass = "bg-green-100 text-green-800";
                                    else if (percentage >= 50) colorClass = "bg-yellow-100 text-yellow-800";
                                    else colorClass = "bg-red-100 text-red-800";
                                }

                                return (
                                    <div key={stat.name} className="bg-white p-4 rounded-xl border border-slate-200 shadow-sm">
                                        <div className="flex justify-between items-center mb-2">
                                            <h4 className="font-bold text-slate-700">{stat.name}</h4>
                                            <span className={`px-2 py-1 rounded text-xs font-bold ${colorClass}`}>
                                                {stat.attempted > 0 ? `${percentage}%` : 'Not Started'}
                                            </span>
                                        </div>
                                        <div className="text-sm text-slate-500 flex justify-between">
                                            <span>Progress: {stat.attempted}/{stat.total} Qs</span>
                                            <span>Accuracy: {stat.correct}/{stat.attempted}</span>
                                        </div>
                                        <div className="w-full bg-slate-100 h-2 rounded-full mt-2 overflow-hidden">
                                            <div 
                                                className="bg-indigo-500 h-full" 
                                                style={{ width: `${(stat.attempted / stat.total) * 100}%` }}
                                            ></div>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                </div>
            );
        }

        function Quiz({ chapter, onBack, userAnswers, onAnswer }) {
            const [index, setIndex] = useState(0);
            const [submitted, setSubmitted] = useState(false);
            const [currentSelection, setCurrentSelection] = useState(null);

            // Filter questions based on chapter selection
            const filteredQuestions = useMemo(() => {
                if (chapter === 'ALL') return QUESTIONS;
                return QUESTIONS.filter(q => q.concept === chapter);
            }, [chapter]);

            const question = filteredQuestions[index];
            const isLast = index === filteredQuestions.length - 1;

            // Check if this specific question was already answered in history
            const previouslyAnswered = userAnswers[question.id];

            useEffect(() => {
                window.scrollTo(0, 0);
                setSubmitted(!!previouslyAnswered);
                setCurrentSelection(previouslyAnswered || null);
            }, [index, question, previouslyAnswered]);

            const handleOptionClick = (optId) => {
                if (submitted) return;
                setCurrentSelection(optId);
            };

            const handleCheck = () => {
                setSubmitted(true);
                onAnswer(question.id, currentSelection);
            };

            const handleNext = () => {
                if (isLast) {
                    onBack(); // Go back to menu when done
                } else {
                    setIndex(prev => prev + 1);
                }
            };

            return (
                <div className="w-full max-w-2xl mx-auto p-4 md:p-6 fade-in">
                    <div className="flex justify-between items-center mb-4">
                        <button onClick={onBack} className="text-slate-500 hover:text-slate-800 flex items-center font-medium transition-colors">
                            <svg className="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M15 19l-7-7 7-7"></path></svg>
                            Back to Menu
                        </button>
                    </div>

                    <div className="bg-white rounded-2xl shadow-xl overflow-hidden flex flex-col min-h-[600px]">
                        {/* Header */}
                        <div className="p-6 border-b border-slate-100 flex justify-between items-center bg-slate-50">
                            <div>
                                <h1 className="font-bold text-xl text-slate-800">{chapter === 'ALL' ? 'Comprehensive' : chapter}</h1>
                                <span className="text-xs font-semibold uppercase tracking-wider text-indigo-600 bg-indigo-50 px-2 py-1 rounded mt-1 inline-block">
                                    Question {index + 1}
                                </span>
                            </div>
                            <div className="text-right">
                                <span className="text-2xl font-bold text-slate-700">{index + 1}</span>
                                <span className="text-slate-400 text-sm">/{filteredQuestions.length}</span>
                            </div>
                        </div>

                        {/* Progress Bar */}
                        <div className="w-full bg-slate-100 h-1.5">
                            <div 
                                className="bg-indigo-600 h-1.5 transition-all duration-300 ease-out" 
                                style={{ width: `${((index + 1) / filteredQuestions.length) * 100}%` }}
                            ></div>
                        </div>

                        {/* Content */}
                        <div className="p-6 md:p-8 flex-1 overflow-y-auto">
                            <h2 className="text-xl font-medium text-slate-800 mb-8 leading-relaxed">
                                {question.text}
                            </h2>

                            <div className="space-y-3">
                                {question.options.map(opt => {
                                    const isSelected = currentSelection === opt.id;
                                    const isCorrect = opt.id === question.correctAnswer;
                                    
                                    let btnClass = "border-slate-200 hover:bg-slate-50 hover:border-slate-300";
                                    let icon = null;
                                    
                                    if (submitted) {
                                        if (isCorrect) {
                                            btnClass = "bg-green-50 border-green-500 text-green-800 ring-1 ring-green-500";
                                            icon = <Icons.Check />;
                                        } else if (isSelected) {
                                            btnClass = "bg-red-50 border-red-300 text-red-800";
                                            icon = <Icons.X />;
                                        } else {
                                            btnClass = "opacity-50 border-slate-100 bg-slate-50";
                                        }
                                    } else if (isSelected) {
                                        btnClass = "border-indigo-600 bg-indigo-50 text-indigo-700 ring-2 ring-indigo-600";
                                    }

                                    return (
                                        <button
                                            key={opt.id}
                                            onClick={() => handleOptionClick(opt.id)}
                                            disabled={submitted}
                                            className={`w-full text-left p-4 rounded-xl border-2 transition-all duration-200 flex items-center justify-between group ${btnClass}`}
                                        >
                                            <div className="flex gap-4 items-center">
                                                <span className={`flex-shrink-0 w-8 h-8 flex items-center justify-center rounded-full text-sm font-bold ${
                                                    isSelected || (submitted && isCorrect) ? 'bg-white shadow-sm' : 'bg-slate-100 text-slate-500 group-hover:bg-white'
                                                }`}>
                                                    {opt.id}
                                                </span>
                                                <span className="text-base">{opt.text}</span>
                                            </div>
                                            {icon}
                                        </button>
                                    );
                                })}
                            </div>

                            {submitted && (
                                <div className="mt-8 p-6 bg-blue-50 border border-blue-100 rounded-xl fade-in">
                                    <div className="flex items-center gap-2 mb-2 text-blue-800 font-bold">
                                        <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                        Explanation
                                    </div>
                                    <p className="text-blue-900 leading-relaxed">
                                        {question.explanation}
                                    </p>
                                </div>
                            )}
                        </div>

                        {/* Footer */}
                        <div className="p-6 border-t border-slate-100 bg-slate-50">
                            {!submitted ? (
                                <button 
                                    onClick={handleCheck}
                                    disabled={!currentSelection}
                                    className="w-full py-4 bg-indigo-600 text-white rounded-xl font-bold text-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-md hover:shadow-lg transform active:scale-[0.99]"
                                >
                                    Check Answer
                                </button>
                            ) : (
                                <button 
                                    onClick={handleNext}
                                    className="w-full py-4 bg-slate-800 text-white rounded-xl font-bold text-lg hover:bg-slate-700 flex items-center justify-center transition-all shadow-md hover:shadow-lg transform active:scale-[0.99]"
                                >
                                    {isLast ? "Finish Chapter" : "Next Question"} <Icons.ArrowRight />
                                </button>
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        function App() {
            const [currentView, setCurrentView] = useState('MENU'); // MENU, QUIZ, DIAGNOSTICS
            const [selectedChapter, setSelectedChapter] = useState(null);
            
            // Persistent storage for all answers: { questionId: selectedOptionId }
            const [userAnswers, setUserAnswers] = usePersistedState('hkdse-physics-answers', {});

            const handleAnswer = (qId, optionId) => {
                setUserAnswers(prev => ({
                    ...prev,
                    [qId]: optionId
                }));
            };

            const handleReset = () => {
                if(confirm("Are you sure you want to clear all your progress?")) {
                    setUserAnswers({});
                }
            };

            const startQuiz = (chapter) => {
                setSelectedChapter(chapter);
                setCurrentView('QUIZ');
            };

            if (currentView === 'DIAGNOSTICS') {
                return <DiagnosticsView userAnswers={userAnswers} onBack={() => setCurrentView('MENU')} />;
            }

            if (currentView === 'QUIZ') {
                return (
                    <Quiz 
                        chapter={selectedChapter} 
                        onBack={() => setCurrentView('MENU')} 
                        userAnswers={userAnswers}
                        onAnswer={handleAnswer}
                    />
                );
            }

            return (
                <Menu 
                    onSelectChapter={startQuiz} 
                    onViewDiagnostics={() => setCurrentView('DIAGNOSTICS')}
                    userAnswers={userAnswers}
                    onReset={handleReset}
                />
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>